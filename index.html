<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <!-- <link rel="stylesheet" href="Bootstrab/css/bootstrap.css"> -->
    <title>Document</title>
</head>
<body>

  <div style="display: none;" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading...</p>
  </div>

    <div class="container">
      <h2> انشاء منتج</h2>
      
      <div class="form-group">
        <label for="product-name">اسم المنتج</label>
        <input type="text" id="product-name" name="product-name" required>
      </div>
      
      
      
      <label for="sub-images">اختر 6 صور لعرض منتجك</label>
      <div class="sub-images-container">
        <div class="form-group">
          <label for="sub-image1-input" id="sub-image1-label" class="image-label">
            <img id="sub-image1" class="sub-image" src="https://4.bp.blogspot.com/-ULzmncU6Tec/Vqoo_BzwjAI/AAAAAAAASCk/iHFlQvwJhLc/s1600/abstract_bokeh-wallpaper-2560x1600-526x351.jpg" alt="الصورة المحددة">
            <input class="img_pro" type="file" id="sub-image1-input" name="sub-image1" accept="image/*" onchange="loadImage(event, 'sub-image1')" style="display: none;">
          </label>
        </div>
      
        <div class="form-group">
          <label for="sub-image2-input" id="sub-image2-label" class="image-label">
            <img id="sub-image2" class="sub-image" src="https://4.bp.blogspot.com/-ULzmncU6Tec/Vqoo_BzwjAI/AAAAAAAASCk/iHFlQvwJhLc/s1600/abstract_bokeh-wallpaper-2560x1600-526x351.jpg" alt="الصورة المحددة">
            <input class="img_pro" type="file" id="sub-image2-input" name="sub-image2" accept="image/*" onchange="loadImage(event, 'sub-image2')" style="display: none;">
          </label>
        </div>
      
        <div class="form-group">
          <label for="sub-image3-input" id="sub-image3-label" class="image-label">
            <img id="sub-image3" class="sub-image" src="https://4.bp.blogspot.com/-ULzmncU6Tec/Vqoo_BzwjAI/AAAAAAAASCk/iHFlQvwJhLc/s1600/abstract_bokeh-wallpaper-2560x1600-526x351.jpg" alt="الصورة المحددة">
            <input class="img_pro" type="file" id="sub-image3-input" name="sub-image3" accept="image/*" onchange="loadImage(event, 'sub-image3')" style="display: none;">
          </label>
        </div>
      
        <div class="form-group">
          <label for="sub-image4-input" id="sub-image4-label" class="image-label">
            <img id="sub-image4" class="sub-image" src="https://4.bp.blogspot.com/-ULzmncU6Tec/Vqoo_BzwjAI/AAAAAAAASCk/iHFlQvwJhLc/s1600/abstract_bokeh-wallpaper-2560x1600-526x351.jpg" alt="الصورة المحددة">
            <input class="img_pro" type="file" id="sub-image4-input" name="sub-image4" accept="image/*" onchange="loadImage(event, 'sub-image4')" style="display: none;">
          </label>
        </div>

        <div class="form-group">
          <label for="sub-image5-input" id="sub-image5-label" class="image-label">
            <img id="sub-image5" class="sub-image" src="https://4.bp.blogspot.com/-ULzmncU6Tec/Vqoo_BzwjAI/AAAAAAAASCk/iHFlQvwJhLc/s1600/abstract_bokeh-wallpaper-2560x1600-526x351.jpg" alt="الصورة المحددة">
            <input class="img_pro" type="file" id="sub-image5-input" name="sub-image5" accept="image/*" onchange="loadImage(event, 'sub-image5')" style="display: none;">
          </label>
        </div>

        <div class="form-group">
          <label for="sub-image6-input" id="sub-image6-label" class="image-label">
            <img id="sub-image6" class="sub-image" src="https://4.bp.blogspot.com/-ULzmncU6Tec/Vqoo_BzwjAI/AAAAAAAASCk/iHFlQvwJhLc/s1600/abstract_bokeh-wallpaper-2560x1600-526x351.jpg" alt="الصورة المحددة">
            <input class="img_pro" type="file" id="sub-image6-input" name="sub-image6" accept="image/*" onchange="loadImage(event, 'sub-image6')" style="display: none;">
          </label>
        </div>
      </div>
      
      <div class="form-group">
        <label for="product-name"> وصف المنتج </label>
        <textarea style="padding: 10px; font-size: 15px; font-weight: 600; " name="" id="notes"   rows="8"></textarea>
      </div>

      <div class="form-group">
        <label for="free-subscription-feature2"> سعر المنتج </label>
        <input type="number" id="price" name="price" required lang="en">
      </div>            

      <div class="form-group">
        <label>اختيار الاشتراك:</label>
        <div class="subscription-option">
          <input type="radio" id="subscription-free" name="subscription" value="subscription-free" required>
          <label class="subscription-label" for="subscription-free">اشتراك مجاني</label>
        </div>
        
        <!-- تفاصيل الاشتراك المجاني -->
        <div class="free-subscription-details">
          <div class="form-group">
            <label for="free-subscription-feature1"> يتم اضافة 10% على السعر المراد به كنسبة لارباح المتجر </label>
          </div>

          <div class="inp_value_price">
            <div class="form-group">
              <label for="free-subscription-feature1"> السعر المراد به </label>
              <input type="number" id="free-subscription-feature1" name="free-subscription-feature1" required>
            </div>
  
            <div class="form-group">
              <label for="free-subscription-feature2"> السعر المعروض </label>
              <input type="number" id="free-subscription-feature2" name="free-subscription-feature2" required lang="en">
            </div>            
          </div>
        </div>
        
        <div class="subscription-option">
          <input type="radio" id="subscription-30" name="subscription" value="subscription-30" required>
          <label class="subscription-label" for="subscription-30">اشتراك 30 يوم</label>
        </div>
        <div class="subscription-option">
          <input type="radio" id="subscription-45" name="subscription" value="subscription-45" required>
          <label class="subscription-label" for="subscription-45">اشتراك 45 يوم</label>
        </div>
        <div class="subscription-option">
          <input type="radio" id="subscription-60" name="subscription" value="subscription-60" required>
          <label class="subscription-label" for="subscription-60">اشتراك 60 يوم</label>
        </div>
      </div>
      <p style="display: none ;color: red; width: 100%; text-align: center;background-color: rgba(255, 0, 0, 0.229);font-weight: 600; font-size: 17px;"> برجاء اكمال بيانات المنتج </p>
      <button type="submit" class="submit-button">انشاء المنتج</button>
    </div>

  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
    import { getDatabase, get, ref, push, set, onValue, } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, uploadBytesResumable } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-storage.js";

    
    // تهيئة Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBwZfny_2TzY0bkiLQaizOkXXZW7TmDdTo",
        authDomain: "photo-b068f.firebaseapp.com",
        databaseURL: "https://photo-b068f-default-rtdb.firebaseio.com",
        projectId: "photo-b068f",
        storageBucket: "photo-b068f.appspot.com",
        messagingSenderId: "966297667659",
        appId: "1:966297667659:web:910805bf7d904230a3e5ce"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    let Allphoto = 1;
    let supction;
    let arrimgs = []
    let NameFile = document.getElementById('product-name')
    let NotesFile = document.getElementById('notes')
    let inpPis1 = document.getElementById('free-subscription-feature1')
    let inpPis2 = document.getElementById('free-subscription-feature2')
    let inpPis3 = document.getElementById('price')
    let radio1 = document.querySelectorAll("[name = 'subscription']")

    function uploadImage(fileId) {
        if(Allphoto < 7){

            let fileInput = document.getElementById(`${fileId}`);
            let file = fileInput.files[0];

            let storageReference = storageRef(storage, `${NameFile.value}/` + file.name);
            uploadBytes(storageReference, file).then((snapshot) => {
                console.log("تم تحميل الصورة بنجاح");


                getDownloadURL(snapshot.ref).then((downloadURL) => {
                  console.log(downloadURL)
                  arrimgs.push(downloadURL)
                  Allphoto++
                  if(Allphoto == 7){
                    uplouddata(); console.log(arrimgs) 
                    setTimeout(() =>{
                      location.reload()
                    },1000)
                  }
                  });
            });
        }

    }
    let Allimg = document.querySelectorAll('.img_pro')
    document.querySelector('.submit-button').addEventListener('click',() =>{
        if (NameFile.value !== ''){

          Allimg.forEach(btn =>{
            console.log(btn.id)
            uploadImage(btn.id)
          })
          console.log('tt')
          document.querySelector('.loading-container').style.display = 'flex'
        }
        else{ NameFile.classList.add('erorr');console.log('1') }
    })

    document.getElementById('subscription-free').addEventListener('click',() =>{

        var freeSubscriptionDetails = document.querySelector('.free-subscription-details');
        if (document.getElementById('subscription-free').checked) {
            freeSubscriptionDetails.classList.add('show');
            inpPis1.focus()
        } else {
            freeSubscriptionDetails.classList.remove('show');
        }

        var otherSubscriptions = document.querySelectorAll('.subscription-option input[type="radio"]:not(#subscription-free)');
        for (var i = 0; i < otherSubscriptions.length; i++) {
            otherSubscriptions[i].addEventListener('click', function() {
                freeSubscriptionDetails.classList.remove('show');
            });
        }
    })



      radio1.forEach(btn =>{
        btn.addEventListener('click',() =>{
          supction = btn.id
        })
      })

    

    inpPis1.addEventListener('focus',() =>{
      inpPis2.value = Math.round(inpPis1.value * 1.1)
      inpPis3.value = inpPis2.value
    })
    inpPis1.addEventListener('keyup',() =>{
      inpPis2.value = Math.round(inpPis1.value * 1.1)
      inpPis3.value = inpPis2.value
    })
    inpPis2.addEventListener('keyup',() =>{
      inpPis1.value = Math.round(inpPis2.value / 1.1)
      inpPis3.value = inpPis2.value
    })

    function uplouddata(){
      const Ref = ref(db,'product')
      let arrdata = []

      let newpro = {
        nameproduct:NameFile.value,
        notes:NotesFile.value,
        prise:inpPis3.value,
        Subscription:supction,
        imgs:
        {
          img1:arrimgs[0],
          img2:arrimgs[1],
          img3:arrimgs[2],
          img4:arrimgs[3],
          img5:arrimgs[4],
          img6:arrimgs[5],
        },
      }
      
      arrdata.push(newpro)
      push(Ref,arrdata[0]).then((isSub) =>{
        document.querySelector('.loading-container').style.display = 'none'
      })

    }

    NameFile.classList.add('erorr')
  </script>



    <script>
        function loadImage(event, imageId) {
        var file = event.target.files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
            var image = document.getElementById(imageId);
            image.src = e.target.result;
            console.log(imageId)

        };
        reader.readAsDataURL(file);
    }
    </script>
    <!-- <script src="Bootstrab/umd/popper.js"></script>
    <script src="Bootstrab/js/code.jquery.com_jquery-3.7.0.min.js"></script>
    <script src="Bootstrab/js/bootstrap.js"></script> -->
  </body>
</html>